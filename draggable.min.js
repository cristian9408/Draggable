/* Written by Erik Terwan - MIT license - https://github.com/terwanerik */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Draggable=t()}(this,function(){"use strict";return function(e){function t(e){return r.find(function(e){return e.element==this?e:void 0},e)}var n=function(e,t){function n(e){for(var t,n=[],r=0;r<e.length;r++)t=e[r],n[t.nodeName]=t.nodeValue;return n}function r(e,t){for(var n in t)t.hasOwnProperty(n)&&e.hasAttribute(n)&&e.removeAttribute(n)}function a(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n])}var u=this;u.parent=null,u.element=null,u.dragGroup=null,u.active=!1;var i=function(e){return function(t,n){return e.parent=t,e.element=n,e}}(u);return u.start=function(e){return function(){e.element.addEventListener("dragstart",o,!1),e.element.addEventListener("dragenter",l,!1),e.element.addEventListener("dragover",d,!1),e.element.addEventListener("dragleave",f,!1),e.element.addEventListener("drop",c,!1),e.element.setAttribute("draggable",!0);var t=e.element.getAttribute("data-drag");return t&&t.length>0&&(e.dragGroup=t),e.active=!0,e}}(u),u.dragStarted=function(e){return function(){return e.element.hasAttribute("data-dragStarted")||e.element.setAttribute("data-dragStarted",""),e}}(u),u.dragOver=function(e){return function(){return e.element.hasAttribute("data-dragOver")||e.element.setAttribute("data-dragOver",""),e}}(u),u.dragLeave=function(e){return function(){return e.element.hasAttribute("data-dragOver")&&e.element.removeAttribute("data-dragOver"),e}}(u),u.dragDone=function(e){return function(){return e.element.hasAttribute("data-dragStarted")&&e.element.removeAttribute("data-dragStarted"),e.element.hasAttribute("data-dragOver")&&e.element.removeAttribute("data-dragOver"),e}}(u),u.swapWith=function(e){return function(t){var u=e.element,i=t.element,o=n(e.element.attributes),l=n(t.element.attributes);r(e.element,o),r(t.element,l);var d=e.element.innerHTML,f=t.element.innerHTML;return a(e.element,l),a(t.element,o),u.innerHTML=f,i.innerHTML=d,e}}(u),u.stop=function(e){return function(){return e.active&&(e.element.removeEventListener("dragstart",o,!1),e.element.removeEventListener("dragenter",l,!1),e.element.removeEventListener("dragover",d,!1),e.element.removeEventListener("dragleave",f,!1),e.element.removeEventListener("mouseup",c,!1),e.element.setAttribute("draggable",!1),e.active=!1),e}}(u),u.destroy=function(e){return function(){e.stop(),u=null,e=null}}(u),i(e,t)};this.callback=null;var r=[],a=null,u=null,i=function(e){return function(t){return e.add(t),e}}(this);this.add=function(e){return function(t){if(!t)return e;var a=t;return t instanceof HTMLElement&&(a=[t]),[].forEach.call(a,function(t){var a=new n(e,t);a.start(),r.push(a)}),e}}(this),this.listen=function(e){return function(t){e.callback=t}}(this),this.clear=function(){return function(){r.forEach(function(e){e.destroy()}),r=[]}}(this);var o=function(){return function(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.innerHTML),a=t(this),a.dragStarted()}}(this),l=function(){return function(e){e.preventDefault&&e.preventDefault(),u=t(this)}}(this),d=function(){return function(e){e.preventDefault&&e.preventDefault(),u=t(this),u!=a&&u.dragGroup==a.dragGroup&&u.dragOver()}}(this),f=function(){return function(e){e.preventDefault&&e.preventDefault(),u!=a&&u.dragGroup==a.dragGroup&&u.dragLeave()}}(this),c=function(e){return function(t){t.stopPropagation&&t.stopPropagation(),a&&a.dragDone(),u&&u.dragDone(),u!=a&&null!=u&&null!=a&&u.dragGroup==a.dragGroup&&(a.swapWith(u),e.callback instanceof Function&&e.callback.call(e,a.element,u.element))}}(this);return i(e)}});